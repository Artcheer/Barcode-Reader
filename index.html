<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leitor de Código de Barras</title>
</head>
<body>
  <input type="text" id="barcodeInput" placeholder="Número do Código de Barras">
  <button onclick="startBarcodeScanner()">Iniciar Leitura</button>
  <video id="reader" width="640" height="480" autoplay></video>
  <script src="https://raw.githubusercontent.com/mebjas/html5-qrcode/master/minified/html5-qrcode.min.js"></script>
  <script>
    // Cria um novo leitor de QR Code
    const html5QrCode = new Html5Qrcode('reader');

    // Inicia o leitor de QR Code
    html5QrCode.start(
      { facingMode: 'environment' }, // Usa a câmera traseira (se disponível)
      {
        fps: 10, // Taxa de quadros por segundo
        qrbox: 250 // Tamanho do quadro de leitura do QR Code
      },
      qrCodeMessage => {
        // Quando um QR Code é lido, exibe a mensagem no console
        console.log('QR Code lido:', qrCodeMessage);
      },
      errorMessage => {
        // Em caso de erro, exibe a mensagem de erro no console
        console.error('Erro ao ler QR Code:', errorMessage);
      }
    );

    function startBarcodeScanner() {
      // Solicita permissão para acessar a câmera
      console.log("Função Ativada!")
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
          var video = document.getElementById('reader');
          video.srcObject = stream;
          video.play();

          setInterval(function() {
            var canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            var code = jsQR(imageData.data, canvas.width, canvas.height);

            if (code) {
              document.getElementById('barcodeInput').value = code.data;
            }
          }, 1000);
        })
        .catch(function(err) {
          console.error('Erro ao acessar a câmera:', err);
        });
    }
  </script>
</body>
</html>
